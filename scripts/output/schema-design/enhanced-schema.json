{
  "version": "2.0.0",
  "generatedAt": "2026-01-10T16:07:06.858Z",
  "improvements": {
    "newFields": [
      {
        "name": "metadata",
        "type": "jsonb",
        "required": false,
        "indexed": true,
        "description": "Flexible JSON storage for page metadata (OG tags, custom fields)",
        "example": "{\"ogImage\": \"...\", \"customField\": \"value\"}"
      },
      {
        "name": "searchVector",
        "type": "tsvector",
        "required": false,
        "indexed": true,
        "description": "Full-text search vector (computed from title + content)"
      },
      {
        "name": "contentHash",
        "type": "text",
        "required": false,
        "indexed": true,
        "unique": false,
        "description": "SHA-256 hash of content for change detection"
      },
      {
        "name": "lastScrapedAt",
        "type": "timestamp",
        "required": false,
        "indexed": true,
        "description": "Last time content was scraped/updated from source"
      },
      {
        "name": "viewCount",
        "type": "integer",
        "required": false,
        "indexed": true,
        "description": "Page view counter for analytics"
      },
      {
        "name": "seoScore",
        "type": "integer",
        "required": false,
        "indexed": true,
        "description": "Calculated SEO score (0-100)"
      }
    ],
    "newIndexes": [
      "GIN index on metadata JSONB column",
      "GIN index on searchVector for full-text search",
      "Composite index on (status, publishedDate) for blog queries",
      "Composite index on (jobType, role) for attorney filtering",
      "Partial index on published blog posts (WHERE status = \"published\")",
      "B-tree index on contentHash for duplicate detection"
    ],
    "newRelationships": [
      "blog -> relatedBlogPosts (self-referential many-to-many)",
      "attorneys -> relatedAttorneys (peer relationships)",
      "practice-areas -> relatedPracticeAreas (hierarchical relationships)",
      "blog -> caseResults (related case studies)"
    ],
    "performanceOptimizations": [
      "Add materialized view for attorney directory (refreshed daily)",
      "Add materialized view for practice area listings",
      "Add computed columns for common queries (e.g., attorneyCount)",
      "Implement connection pooling with PgBouncer",
      "Add read replicas for heavy read workloads",
      "Implement Redis caching for frequently accessed content",
      "Add database-level full-text search with PostgreSQL tsvector",
      "Normalize repeated data into lookup tables (locations, dates)"
    ]
  },
  "collections": [
    {
      "name": "Blog Posts",
      "slug": "blog",
      "description": "Enhanced blog collection with improved search and metadata",
      "fields": [
        {
          "name": "metadata",
          "type": "jsonb",
          "required": false,
          "indexed": true,
          "description": "OG tags, custom metadata"
        },
        {
          "name": "readingTime",
          "type": "number",
          "required": false,
          "indexed": true,
          "description": "Estimated reading time in minutes (computed)"
        },
        {
          "name": "relatedBlogPosts",
          "type": "relationship",
          "required": false,
          "indexed": true,
          "description": "Related blog posts (many-to-many)"
        },
        {
          "name": "caseResults",
          "type": "relationship",
          "required": false,
          "indexed": true,
          "description": "Related case results"
        }
      ],
      "indexes": [
        "slug (unique)",
        "publishedDate DESC",
        "(status, publishedDate)",
        "searchVector (GIN)",
        "metadata (GIN)"
      ],
      "relationships": [
        "author -> attorneys",
        "relatedBlogPosts -> blog (many-to-many)",
        "relatedPracticeAreas -> practice-areas",
        "caseResults -> case-results"
      ],
      "optimizations": [
        "Materialized view for published posts",
        "Full-text search index",
        "Cache popular posts"
      ]
    },
    {
      "name": "Attorneys",
      "slug": "attorneys",
      "description": "Enhanced attorney collection with better relationships",
      "fields": [
        {
          "name": "relatedAttorneys",
          "type": "relationship",
          "required": false,
          "indexed": true,
          "description": "Related attorneys (peer relationships)"
        },
        {
          "name": "expertiseLevel",
          "type": "select",
          "required": false,
          "indexed": true,
          "description": "Expertise level (junior, mid, senior, partner)"
        },
        {
          "name": "yearsOfExperience",
          "type": "number",
          "required": false,
          "indexed": true,
          "description": "Years of experience (computed from bar admission)"
        },
        {
          "name": "caseWinRate",
          "type": "number",
          "required": false,
          "indexed": false,
          "description": "Case win rate percentage (if tracked)"
        }
      ],
      "indexes": [
        "slug (unique)",
        "(jobType, role)",
        "email (unique)",
        "searchVector (GIN)"
      ],
      "relationships": [
        "practices -> practice-areas (many-to-many)",
        "relatedAttorneys -> attorneys (many-to-many)",
        "industries -> industries (many-to-many)"
      ],
      "optimizations": [
        "Materialized view for attorney directory",
        "Computed fields for statistics"
      ]
    },
    {
      "name": "Practice Areas",
      "slug": "practice-areas",
      "description": "Enhanced practice area with hierarchical support",
      "fields": [
        {
          "name": "parentPracticeArea",
          "type": "relationship",
          "required": false,
          "indexed": true,
          "description": "Parent practice area (for hierarchies)"
        },
        {
          "name": "relatedPracticeAreas",
          "type": "relationship",
          "required": false,
          "indexed": true,
          "description": "Related practice areas"
        },
        {
          "name": "attorneyCount",
          "type": "number",
          "required": false,
          "indexed": true,
          "description": "Number of attorneys in this practice (computed)"
        },
        {
          "name": "caseStudyCount",
          "type": "number",
          "required": false,
          "indexed": true,
          "description": "Number of case studies (computed)"
        }
      ],
      "indexes": [
        "slug (unique)",
        "parentPracticeArea",
        "searchVector (GIN)"
      ],
      "relationships": [
        "parentPracticeArea -> practice-areas (self-referential)",
        "relatedPracticeAreas -> practice-areas (many-to-many)",
        "featuredAttorneys -> attorneys"
      ],
      "optimizations": [
        "Materialized view for practice area tree",
        "Computed counts for performance"
      ]
    }
  ],
  "migrationScript": "\n-- Enhanced Database Schema Migration\n-- Generated: 2026-01-10T16:07:06.858Z\n\n-- 1. Add metadata JSONB column to all content collections\nALTER TABLE \"blog\" ADD COLUMN IF NOT EXISTS \"metadata\" JSONB;\nALTER TABLE \"attorneys\" ADD COLUMN IF NOT EXISTS \"metadata\" JSONB;\nALTER TABLE \"practice_areas\" ADD COLUMN IF NOT EXISTS \"metadata\" JSONB;\n\n-- 2. Add search vector columns\nALTER TABLE \"blog\" ADD COLUMN IF NOT EXISTS \"search_vector\" tsvector;\nALTER TABLE \"attorneys\" ADD COLUMN IF NOT EXISTS \"search_vector\" tsvector;\nALTER TABLE \"practice_areas\" ADD COLUMN IF NOT EXISTS \"search_vector\" tsvector;\n\n-- 3. Add content hash for change detection\nALTER TABLE \"blog\" ADD COLUMN IF NOT EXISTS \"content_hash\" TEXT;\nALTER TABLE \"attorneys\" ADD COLUMN IF NOT EXISTS \"content_hash\" TEXT;\n\n-- 4. Add last scraped timestamp\nALTER TABLE \"blog\" ADD COLUMN IF NOT EXISTS \"last_scraped_at\" TIMESTAMP;\nALTER TABLE \"attorneys\" ADD COLUMN IF NOT EXISTS \"last_scraped_at\" TIMESTAMP;\n\n-- 5. Add view count\nALTER TABLE \"blog\" ADD COLUMN IF NOT EXISTS \"view_count\" INTEGER DEFAULT 0;\nALTER TABLE \"attorneys\" ADD COLUMN IF NOT EXISTS \"view_count\" INTEGER DEFAULT 0;\n\n-- 6. Create GIN indexes for JSONB and full-text search\nCREATE INDEX IF NOT EXISTS \"blog_metadata_gin\" ON \"blog\" USING GIN (\"metadata\");\nCREATE INDEX IF NOT EXISTS \"blog_search_vector_gin\" ON \"blog\" USING GIN (\"search_vector\");\nCREATE INDEX IF NOT EXISTS \"attorneys_metadata_gin\" ON \"attorneys\" USING GIN (\"metadata\");\nCREATE INDEX IF NOT EXISTS \"attorneys_search_vector_gin\" ON \"attorneys\" USING GIN (\"search_vector\");\nCREATE INDEX IF NOT EXISTS \"practice_areas_metadata_gin\" ON \"practice_areas\" USING GIN (\"metadata\");\nCREATE INDEX IF NOT EXISTS \"practice_areas_search_vector_gin\" ON \"practice_areas\" USING GIN (\"search_vector\");\n\n-- 7. Create composite indexes for common queries\nCREATE INDEX IF NOT EXISTS \"blog_status_published_date_idx\" ON \"blog\" (\"status\", \"publishedDate\" DESC) WHERE \"status\" = 'published';\nCREATE INDEX IF NOT EXISTS \"attorneys_job_type_role_idx\" ON \"attorneys\" (\"jobType\", \"role\");\n\n-- 8. Create function to update search vector\nCREATE OR REPLACE FUNCTION update_search_vector()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.search_vector :=\n    setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||\n    setweight(to_tsvector('english', COALESCE(NEW.excerpt, '')), 'B') ||\n    setweight(to_tsvector('english', COALESCE(NEW.\"content\"::text, '')), 'C');\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- 9. Create triggers to auto-update search vectors\nCREATE TRIGGER blog_search_vector_update\n  BEFORE INSERT OR UPDATE ON \"blog\"\n  FOR EACH ROW EXECUTE FUNCTION update_search_vector();\n\nCREATE TRIGGER attorneys_search_vector_update\n  BEFORE INSERT OR UPDATE ON \"attorneys\"\n  FOR EACH ROW EXECUTE FUNCTION update_search_vector();\n\n-- 10. Create materialized view for attorney directory\nCREATE MATERIALIZED VIEW IF NOT EXISTS attorney_directory AS\nSELECT\n  a.id,\n  a.name,\n  a.slug,\n  a.\"jobType\",\n  a.role,\n  a.email,\n  COUNT(DISTINCT pa.id) as practice_area_count,\n  COUNT(DISTINCT b.id) as blog_post_count\nFROM \"attorneys\" a\nLEFT JOIN \"_practices_attorneys\" pa_rel ON a.id = pa_rel.\"attorneys_id\"\nLEFT JOIN \"practice_areas\" pa ON pa_rel.\"practice_areas_id\" = pa.id\nLEFT JOIN \"blog\" b ON b.\"author\" = a.id\nWHERE a.\"jobType\" = 'attorney'\nGROUP BY a.id, a.name, a.slug, a.\"jobType\", a.role, a.email;\n\nCREATE UNIQUE INDEX IF NOT EXISTS attorney_directory_id_idx ON attorney_directory (id);\n\n-- 11. Create refresh function for materialized views\nCREATE OR REPLACE FUNCTION refresh_materialized_views()\nRETURNS void AS $$\nBEGIN\n  REFRESH MATERIALIZED VIEW CONCURRENTLY attorney_directory;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Note: Run REFRESH MATERIALIZED VIEW attorney_directory; after data changes\n"
}